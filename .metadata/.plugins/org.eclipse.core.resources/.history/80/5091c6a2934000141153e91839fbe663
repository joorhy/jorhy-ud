#!/usr/bin/env python
# -*- coding: utf-8 -*-
from framework.CSingleton import CSingleton
from service.logic.CSvcPrinterScheme import CSvcPrinterScheme
from framework.CEvtManager import CEvtManager
from app.logic.CEnumEvent import CEnumEvent

class CDataPrinterScheme(object):
    def __init__(self, id_, code, name, valid, scheme_type, print_couny, backup):
        self.id = id_
        self.code = code
        self.name = name
        self.valid = valid
        self.scheme_type = scheme_type
        self.print_couny = print_couny
        self.backup = backup
        
class CDataPrinterSchemeInfo(CSingleton):
    cur_item_index = 0
    table_items = list()
    
    def __repr__(self):
        return '%s' % (self.__class__.__name__)
    
    @staticmethod
    def GetCurItemIndex():
        return CDataPrinterSchemeInfo.cur_item_index
    
    @staticmethod
    def SetCurItemIndex(index):
        CDataPrinterSchemeInfo.cur_item_index = index
    
    @staticmethod
    def GetData():
        result = CSvcPrinterScheme.GetAll()
        data = list()
        for item in result:
            data_item = CDataPrinterScheme(item[0], item[1], item[2], item[3], item[4], item[5])
            data.append(data_item)
            
        return data
    
    @staticmethod
    def RefreshItems():
        del CDataPrinterSchemeInfo.table_items[0:len(CDataPrinterSchemeInfo.table_items)]
        result = CDataPrinterScheme.GetItems()
        for item in result:
            data_item = CDataPrinterScheme(item[0], item[1], item[2], item[3], item[4], item[5])
            CDataPrinterSchemeInfo.table_items.append(data_item)
            
    @staticmethod
    def GetItems():            
        return CDataPrinterSchemeInfo.table_items
    
    @staticmethod
    def AddItem(data):
        if isinstance(data, CDataPrinterScheme):
            item = [data.code, data.name, data.valid, data.area, data.peple_num, data.min_type]
            CDataPrinterScheme.AddItem(item)
            CEvtManager.DispatchEvent(CEnumEvent.EVT_DINING_ROOM_REFRESH)
    
    @staticmethod      
    def AddItems(data):
        for obj in data:
            if isinstance(obj, CDataPrinterScheme):
                item = [obj.code, obj.name, obj.table_type, obj.area, obj.peple_num, obj.min_type]
                CSvcTableInfo.AddItem(item)
        CEvtManager.DispatchEvent(CEnumEvent.EVT_DINING_ROOM_REFRESH)         
            
    @staticmethod
    def DeleteItem(data):
        if isinstance(data, CDataPrinterScheme):
            item = [data.code, data.name, data.table_type, data.area, data.peple_num, data.min_type]
            CSvcTableInfo.DeleteItem(item)
            CEvtManager.DispatchEvent(CEnumEvent.EVT_DINING_ROOM_REFRESH)
            
    @staticmethod
    def UpdateItem(data):
        if isinstance(data, CDataPrinterScheme):
            item = [data.code, data.name, data.table_type, data.area, data.peple_num, data.min_type]
            CSvcTableInfo.UpdateItem(item)
            CEvtManager.DispatchEvent(CEnumEvent.EVT_DINING_ROOM_REFRESH)